<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å›¾ç‰‡æ‹¼æ¥å·¥å…·</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #fff;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        h1 {
            text-align: center;
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #ff6b6b, #feca57, #48dbfb);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            text-align: center;
            color: #a0a0a0;
            margin-bottom: 40px;
        }

        .controls {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .control-row {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            align-items: center;
            margin-bottom: 20px;
        }

        .control-row:last-child {
            margin-bottom: 0;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .control-group label {
            font-size: 0.85rem;
            color: #a0a0a0;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .upload-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 10px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .upload-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        input[type="file"] {
            display: none;
        }

        select, input[type="number"], input[type="color"] {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 10px 14px;
            border-radius: 8px;
            font-size: 0.95rem;
            outline: none;
            transition: border-color 0.3s;
        }

        select:focus, input[type="number"]:focus {
            border-color: #667eea;
        }

        input[type="number"] {
            width: 80px;
        }

        input[type="color"] {
            width: 50px;
            height: 40px;
            padding: 4px;
            cursor: pointer;
        }

        .preview-area {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 16px;
            padding: 30px;
            min-height: 400px;
            border: 2px dashed rgba(255, 255, 255, 0.15);
            transition: border-color 0.3s;
            margin-bottom: 30px;
        }

        .preview-area.dragover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }

        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 300px;
            color: #666;
        }

        .empty-state svg {
            width: 80px;
            height: 80px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .canvas-container {
            display: flex;
            justify-content: center;
            overflow: auto;
        }

        #canvas {
            max-width: 100%;
            border-radius: 8px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .image-list {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-top: 20px;
        }

        .image-item {
            position: relative;
            width: 100px;
            height: 100px;
            border-radius: 8px;
            overflow: hidden;
            cursor: grab;
            transition: transform 0.2s;
        }

        .image-item:hover {
            transform: scale(1.05);
        }

        .image-item.dragging {
            opacity: 0.5;
            cursor: grabbing;
        }

        .image-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .image-item .remove-btn {
            position: absolute;
            top: 4px;
            right: 4px;
            width: 24px;
            height: 24px;
            background: rgba(255, 59, 48, 0.9);
            border: none;
            border-radius: 50%;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .image-item:hover .remove-btn {
            opacity: 1;
        }

        .image-item .order-num {
            position: absolute;
            bottom: 4px;
            left: 4px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: bold;
        }

        .actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 14px 32px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(56, 239, 125, 0.3);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .tips {
            margin-top: 40px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            border-left: 4px solid #667eea;
        }

        .tips h3 {
            margin-bottom: 10px;
            color: #667eea;
        }

        .tips ul {
            list-style: none;
            color: #a0a0a0;
        }

        .tips li {
            padding: 5px 0;
            padding-left: 20px;
            position: relative;
        }

        .tips li::before {
            content: "â€¢";
            position: absolute;
            left: 0;
            color: #667eea;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.8rem;
            }

            .control-row {
                flex-direction: column;
                align-items: stretch;
            }

            .control-group {
                width: 100%;
            }

            select, input[type="number"] {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ–¼ï¸ å›¾ç‰‡æ‹¼æ¥å·¥å…·</h1>
        <p class="subtitle">ä¸Šä¼ å¤šå¼ å›¾ç‰‡ï¼Œè‡ªç”±æ’åˆ—ç»„åˆï¼Œä¸€é”®å¯¼å‡º</p>

        <div class="controls">
            <div class="control-row">
                <label class="upload-btn">
                    <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                    </svg>
                    æ·»åŠ å›¾ç‰‡
                    <input type="file" id="fileInput" multiple accept="image/*">
                </label>

                <div class="control-group">
                    <label>æ’åˆ—æ–¹å¼</label>
                    <select id="layout">
                        <option value="horizontal">æ¨ªå‘æ’åˆ—</option>
                        <option value="vertical">çºµå‘æ’åˆ—</option>
                        <option value="grid">ç½‘æ ¼æ’åˆ—</option>
                    </select>
                </div>

                <div class="control-group">
                    <label>æ¯è¡Œæ•°é‡ï¼ˆç½‘æ ¼ï¼‰</label>
                    <input type="number" id="columns" value="2" min="1" max="10">
                </div>

                <div class="control-group">
                    <label>é—´è· (px)</label>
                    <input type="number" id="gap" value="10" min="0" max="100">
                </div>

                <div class="control-group">
                    <label>èƒŒæ™¯è‰²</label>
                    <input type="color" id="bgColor" value="#ffffff">
                </div>
            </div>

            <div class="control-row">
                <div class="control-group">
                    <label>å›¾ç‰‡å®½åº¦ (px, 0=è‡ªåŠ¨)</label>
                    <input type="number" id="imageWidth" value="0" min="0" max="2000">
                </div>

                <div class="control-group">
                    <label>å›¾ç‰‡é«˜åº¦ (px, 0=è‡ªåŠ¨)</label>
                    <input type="number" id="imageHeight" value="0" min="0" max="2000">
                </div>

                <div class="control-group">
                    <label>åœ†è§’ (px)</label>
                    <input type="number" id="borderRadius" value="0" min="0" max="100">
                </div>
            </div>
        </div>

        <div class="preview-area" id="previewArea">
            <div class="empty-state" id="emptyState">
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14zm-5-7l-3 3.72L9 13l-3 4h12l-4-5z"/>
                </svg>
                <p>æ‹–æ‹½å›¾ç‰‡åˆ°è¿™é‡Œï¼Œæˆ–ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®æ·»åŠ </p>
            </div>
            <div class="canvas-container" id="canvasContainer" style="display: none;">
                <canvas id="canvas"></canvas>
            </div>
            <div class="image-list" id="imageList"></div>
        </div>

        <div class="actions">
            <button class="btn btn-secondary" id="clearBtn" disabled>
                <svg width="18" height="18" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
                </svg>
                æ¸…ç©ºå…¨éƒ¨
            </button>
            <button class="btn btn-primary" id="downloadBtn" disabled>
                <svg width="18" height="18" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>
                </svg>
                ä¸‹è½½æ‹¼æ¥å›¾
            </button>
        </div>

        <div class="tips">
            <h3>ğŸ’¡ ä½¿ç”¨æç¤º</h3>
            <ul>
                <li>æ”¯æŒ JPGã€PNGã€GIFã€WebP ç­‰å¸¸è§å›¾ç‰‡æ ¼å¼</li>
                <li>æ‹–æ‹½ç¼©ç•¥å›¾å¯ä»¥è°ƒæ•´å›¾ç‰‡é¡ºåº</li>
                <li>è®¾ç½®å®½åº¦æˆ–é«˜åº¦ä¸º 0 è¡¨ç¤ºä¿æŒåŸå§‹æ¯”ä¾‹</li>
                <li>ç½‘æ ¼æ¨¡å¼ä¸‹ï¼Œå›¾ç‰‡ä¼šè‡ªåŠ¨è°ƒæ•´å¤§å°ä»¥ä¿æŒæ•´é½</li>
                <li>å¯¼å‡ºæ ¼å¼ä¸º PNGï¼Œæ”¯æŒé€æ˜èƒŒæ™¯</li>
            </ul>
        </div>
    </div>

    <script>
        const fileInput = document.getElementById('fileInput');
        const previewArea = document.getElementById('previewArea');
        const emptyState = document.getElementById('emptyState');
        const canvasContainer = document.getElementById('canvasContainer');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const imageList = document.getElementById('imageList');
        const downloadBtn = document.getElementById('downloadBtn');
        const clearBtn = document.getElementById('clearBtn');

        const layoutSelect = document.getElementById('layout');
        const columnsInput = document.getElementById('columns');
        const gapInput = document.getElementById('gap');
        const bgColorInput = document.getElementById('bgColor');
        const imageWidthInput = document.getElementById('imageWidth');
        const imageHeightInput = document.getElementById('imageHeight');
        const borderRadiusInput = document.getElementById('borderRadius');

        let images = [];
        let draggedIndex = null;

        // äº‹ä»¶ç›‘å¬
        fileInput.addEventListener('change', handleFileSelect);
        downloadBtn.addEventListener('click', downloadImage);
        clearBtn.addEventListener('click', clearAll);

        [layoutSelect, columnsInput, gapInput, bgColorInput, imageWidthInput, imageHeightInput, borderRadiusInput].forEach(el => {
            el.addEventListener('change', renderCanvas);
            el.addEventListener('input', renderCanvas);
        });

        // æ‹–æ‹½ä¸Šä¼ 
        previewArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            previewArea.classList.add('dragover');
        });

        previewArea.addEventListener('dragleave', () => {
            previewArea.classList.remove('dragover');
        });

        previewArea.addEventListener('drop', (e) => {
            e.preventDefault();
            previewArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            handleFiles(files);
        });

        function handleFileSelect(e) {
            handleFiles(e.target.files);
            fileInput.value = '';
        }

        function handleFiles(files) {
            Array.from(files).forEach(file => {
                if (!file.type.startsWith('image/')) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => {
                        images.push({
                            img: img,
                            src: e.target.result
                        });
                        updateUI();
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            });
        }

        function updateUI() {
            const hasImages = images.length > 0;
            emptyState.style.display = hasImages ? 'none' : 'flex';
            canvasContainer.style.display = hasImages ? 'flex' : 'none';
            downloadBtn.disabled = !hasImages;
            clearBtn.disabled = !hasImages;

            renderImageList();
            renderCanvas();
        }

        function renderImageList() {
            imageList.innerHTML = '';
            images.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'image-item';
                div.draggable = true;
                div.innerHTML = `
                    <img src="${item.src}" alt="å›¾ç‰‡ ${index + 1}">
                    <button class="remove-btn" data-index="${index}">Ã—</button>
                    <span class="order-num">${index + 1}</span>
                `;

                div.addEventListener('dragstart', (e) => {
                    draggedIndex = index;
                    div.classList.add('dragging');
                });

                div.addEventListener('dragend', () => {
                    div.classList.remove('dragging');
                    draggedIndex = null;
                });

                div.addEventListener('dragover', (e) => {
                    e.preventDefault();
                });

                div.addEventListener('drop', (e) => {
                    e.preventDefault();
                    if (draggedIndex !== null && draggedIndex !== index) {
                        const temp = images[draggedIndex];
                        images.splice(draggedIndex, 1);
                        images.splice(index, 0, temp);
                        updateUI();
                    }
                });

                div.querySelector('.remove-btn').addEventListener('click', (e) => {
                    e.stopPropagation();
                    images.splice(index, 1);
                    updateUI();
                });

                imageList.appendChild(div);
            });
        }

        function renderCanvas() {
            if (images.length === 0) return;

            const layout = layoutSelect.value;
            const columns = parseInt(columnsInput.value) || 2;
            const gap = parseInt(gapInput.value) || 0;
            const bgColor = bgColorInput.value;
            const targetWidth = parseInt(imageWidthInput.value) || 0;
            const targetHeight = parseInt(imageHeightInput.value) || 0;
            const borderRadius = parseInt(borderRadiusInput.value) || 0;

            let processedImages = images.map(item => {
                let w = item.img.width;
                let h = item.img.height;

                if (targetWidth > 0 && targetHeight > 0) {
                    w = targetWidth;
                    h = targetHeight;
                } else if (targetWidth > 0) {
                    h = (item.img.height / item.img.width) * targetWidth;
                    w = targetWidth;
                } else if (targetHeight > 0) {
                    w = (item.img.width / item.img.height) * targetHeight;
                    h = targetHeight;
                }

                return { img: item.img, w, h };
            });

            let canvasWidth, canvasHeight;
            let positions = [];

            if (layout === 'horizontal') {
                canvasWidth = processedImages.reduce((sum, img) => sum + img.w, 0) + gap * (images.length - 1);
                canvasHeight = Math.max(...processedImages.map(img => img.h));

                let x = 0;
                processedImages.forEach(img => {
                    positions.push({ x, y: (canvasHeight - img.h) / 2, w: img.w, h: img.h });
                    x += img.w + gap;
                });

            } else if (layout === 'vertical') {
                canvasWidth = Math.max(...processedImages.map(img => img.w));
                canvasHeight = processedImages.reduce((sum, img) => sum + img.h, 0) + gap * (images.length - 1);

                let y = 0;
                processedImages.forEach(img => {
                    positions.push({ x: (canvasWidth - img.w) / 2, y, w: img.w, h: img.h });
                    y += img.h + gap;
                });

            } else if (layout === 'grid') {
                const rows = Math.ceil(images.length / columns);
                const maxW = targetWidth > 0 ? targetWidth : Math.max(...processedImages.map(img => img.w));
                const maxH = targetHeight > 0 ? targetHeight : Math.max(...processedImages.map(img => img.h));

                canvasWidth = columns * maxW + gap * (columns - 1);
                canvasHeight = rows * maxH + gap * (rows - 1);

                processedImages.forEach((img, i) => {
                    const col = i % columns;
                    const row = Math.floor(i / columns);
                    const cellW = maxW;
                    const cellH = maxH;

                    let drawW, drawH;
                    const aspectRatio = img.img.width / img.img.height;

                    if (cellW / cellH > aspectRatio) {
                        drawH = cellH;
                        drawW = cellH * aspectRatio;
                    } else {
                        drawW = cellW;
                        drawH = cellW / aspectRatio;
                    }

                    const x = col * (maxW + gap) + (cellW - drawW) / 2;
                    const y = row * (maxH + gap) + (cellH - drawH) / 2;

                    positions.push({ x, y, w: drawW, h: drawH });
                });
            }

            canvas.width = canvasWidth;
            canvas.height = canvasHeight;

            // èƒŒæ™¯
            ctx.fillStyle = bgColor;
            ctx.fillRect(0, 0, canvasWidth, canvasHeight);

            // ç»˜åˆ¶å›¾ç‰‡
            processedImages.forEach((img, i) => {
                const pos = positions[i];

                if (borderRadius > 0) {
                    ctx.save();
                    roundRect(ctx, pos.x, pos.y, pos.w, pos.h, borderRadius);
                    ctx.clip();
                    ctx.drawImage(img.img, pos.x, pos.y, pos.w, pos.h);
                    ctx.restore();
                } else {
                    ctx.drawImage(img.img, pos.x, pos.y, pos.w, pos.h);
                }
            });
        }

        function roundRect(ctx, x, y, width, height, radius) {
            ctx.beginPath();
            ctx.moveTo(x + radius, y);
            ctx.lineTo(x + width - radius, y);
            ctx.quadraticCurveTo(x + width, y, x + width, y + radius);
            ctx.lineTo(x + width, y + height - radius);
            ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);
            ctx.lineTo(x + radius, y + height);
            ctx.quadraticCurveTo(x, y + height, x, y + height - radius);
            ctx.lineTo(x, y + radius);
            ctx.quadraticCurveTo(x, y, x + radius, y);
            ctx.closePath();
        }

        function downloadImage() {
            const link = document.createElement('a');
            link.download = `æ‹¼æ¥å›¾_${Date.now()}.png`;
            link.href = canvas.toDataURL('image/png');
            link.click();
        }

        function clearAll() {
            images = [];
            updateUI();
        }
    </script>
</body>
</html>
